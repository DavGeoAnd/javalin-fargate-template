# Javalin Web Service on AWS Fargate

## Create IAM User Group (if needed)
1. User group name: Microservices
2. Attach permissions policies - Optional: AdministratorAccess

## Create IAM User (if needed)
1. User name: DavGeoAnd
2. Provide user access to the AWS Management Console - optional: Check
    * User type: I want to create an IAM user
3. Console password: Autogenerated password
4. Users must create a new password at next sign-in - Recommended: Uncheck
5. Permissions options: Add user to group
    * User groups: Microservices
6. Console sign-in: https://dave-aws-dga.signin.aws.amazon.com/console
7. Sign in with IAM user

## Create Load Balancer (if needed)
1. Load balancer types: Application Load Balancer
2. Load balancer name: dga-microservices-{env}
3. Scheme: Internet-facing
4. IP address type: IPv4
5. VPC: dga-vpc
6. Mappings
    * dev - 1a, 1b
    * test - 1c, 1d
    * prod - 1e, 1f
7. Security groups: dga-ms-ecs-lb-sg
    * Security group name: dga-ms-ecs-lb-sg
    * Description: dga-ms-ecs-lb-sg
    * Inbound rules
      * Type: HTTP
      * Source: Anywhere-IPv4
8. Listeners and routing
   * Protocol: HTTP
   * Port: 80
   * Default action: Create target group
     * Target group name: default-tg

## Create ECR Repository
1. 'Visibility settings': Private
2. 'Repository name': javalin-fargate-template-{env}

## Create Cluster (if needed)
1. Cluster name: dga-microservices-{env}
2. Infrastructure: AWS Fargate (serverless)

## Create Task Definition
1. Task definition family: javalin-fargate-template-{env}
2. Launch type: AWS Fargate
3. Task size
    * CPU: .25 vCPU
    * Memory: .5 GB
4. Container - 1
    * Name: javalin-fargate-template
    * Image URI: 396607284401.dkr.ecr.us-east-1.amazonaws.com/javalin-fargate-template-dev:main
    * Port mappings: 10000

## Create Service
1. Existing cluster: dga-microservices-{env}
2. Compute options: Launch type
3. Service name: javalin-fargate-template-{env}[-standby]
4. Subnets
    * dev - 1a, 1b (standby)
    * test - 1c, 1d (standby)
    * prod - 1e, 1f
5. Security group: dga-ms-ecs-sg
    * Security group name: dga-ms-ecs-sg
    * Security group description: open ports for dga microservices
    * Inbound rules for security groups
      * Type: Custom TCP --- Port range: 10000 --- Source: Anywhere
      * Type: HTTP --- Source: Anywhere
6. Load balancer type: Application Load Balancer
7. Application Load Balancer: Use an existing load balancer
8. Load balancer: dga-microservices-{env}
9. Listener: Use an existing listener
    * Listener: 80:HTTP
10. Target group: Create new target group
    * Target group name: javalin-fargate-template-{env}
    * Path pattern: /template/*
    * Evaluation order: 1 (or highest evaluation order + 1)
    * Health check path: /template/health
    * Health check grace period: 120